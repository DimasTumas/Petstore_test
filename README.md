# Petstore API Test Automation

Автоматизированное тестирование API для [Petstore Swagger](https://petstore.swagger.io).

## Описание проекта

Проект содержит автотесты для публичного API Petstore, демонстрирующий:
- Функциональное тестирование REST API
- Расширяемую архитектуру для масштабирования тестов
- Покрытие основных CRUD операций
- Обработку позитивных и негативных сценариев

## Технологический стек

- **Python 3.8+**
- **pytest** - фреймворк для написания и запуска тестов
- **requests** - библиотека для HTTP-запросов
- **jsonschema** (опционально) - валидация JSON-ответов
- **pytest-cov** (опционально) - анализ покрытия кода тестами

## Структура проекта

```
.
├── tests/                  # Тестовые файлы
│   ├── test_pet.py         # Тесты для /pet endpoint
│   └── test_store.py       # Тесты для /store/order endpoint
├── helpers/                # Вспомогательные модули
│   ├── api_client.py       # API клиент для HTTP-запросов
│   └── data_generators.py  # Генераторы тестовых данных
├── conftest.py            # Pytest фикстуры и настройки
├── requirements.txt       # Зависимости проекта
└── README.md             # Документация
```

## Установка и настройка

### Требования

- Python 3.8 или выше
- pip (менеджер пакетов Python)

### Установка зависимостей

1. Клонируйте репозиторий (или убедитесь, что вы находитесь в директории проекта)

2. Установите зависимости:

```bash
pip install -r requirements.txt
```

Или для установки только основных зависимостей:

```bash
pip install pytest requests
```

## Запуск тестов

### Запуск всех тестов

```bash
pytest
```

### Запуск тестов для конкретного endpoint

```bash
# Тесты для /pet
pytest tests/test_pet.py

# Тесты для /store
pytest tests/test_store.py
```

### Запуск конкретного теста

```bash
pytest tests/test_pet.py::TestPetCreate::test_create_pet_success
```

### Запуск с подробным выводом

```bash
pytest -v
```

### Запуск с выводом print-ов

```bash
pytest -s
```

### Запуск с покрытием кода (требует pytest-cov)

```bash
pytest --cov=helpers --cov-report=html
```

После выполнения откройте `htmlcov/index.html` в браузере для просмотра отчета.

### Запуск только позитивных тестов

```bash
pytest -k "success"
```

### Запуск только негативных тестов

```bash
pytest -k "invalid or nonexistent"
```

## Покрытие тестами

### Endpoint: /pet

- ✅ **POST /pet** - создание питомца
  - Создание с полными данными
  - Создание с минимальными данными
  - Создание с различными статусами

- ✅ **GET /pet/{petId}** - получение питомца
  - Получение существующего питомца
  - Получение несуществующего питомца (негативный сценарий)
  - Получение с некорректным ID (негативный сценарий)

- ✅ **PUT /pet** - обновление питомца
  - Обновление существующего питомца
  - Обновление несуществующего питомца

- ✅ **DELETE /pet/{petId}** - удаление питомца
  - Удаление существующего питомца
  - Удаление несуществующего питомца (негативный сценарий)

- ✅ **Полные CRUD циклы** - комплексные сценарии

### Endpoint: /store/order

- ✅ **POST /store/order** - создание заказа
  - Создание заказа с полными данными
  - Создание заказа с минимальными данными

- ✅ **GET /store/order/{orderId}** - получение заказа
  - Получение существующего заказа
  - Получение несуществующего заказа (негативный сценарий)

## Архитектура проекта

### API Client (`helpers/api_client.py`)

Базовый клиент для взаимодействия с Petstore API. Предоставляет методы для:
- Создания, чтения, обновления и удаления питомцев
- Создания и чтения заказов
- Обработки ошибок и валидации ответов

### Data Generators (`helpers/data_generators.py`)

Утилиты для генерации тестовых данных:
- `PetDataGenerator` - генерация данных для питомцев
- `OrderDataGenerator` - генерация данных для заказов

Позволяют создавать данные с различными параметрами для разных тестовых сценариев.

### Fixtures (`conftest.py`)

Pytest фикстуры для:
- Инициализации API клиента
- Доступа к генераторам данных
- Предоставления готовых тестовых данных

### Тесты

Тесты организованы по endpoint-ам и типам операций:
- Каждый класс тестов покрывает определенный тип операции
- Тесты независимы друг от друга
- Изоляция данных обеспечивается использованием уникальных ID

## Принципы расширения проекта

### Добавление нового endpoint

1. Добавьте методы в `helpers/api_client.py`:

```python
def get_new_endpoint(self, id: int) -> requests.Response:
    return self._make_request("GET", f"/new/endpoint/{id}")
```

2. Создайте генератор данных (если требуется) в `helpers/data_generators.py`

3. Создайте файл тестов `tests/test_new_endpoint.py`:

```python
class TestNewEndpoint:
    def test_get_new_endpoint_success(self, api_client):
        response = api_client.get_new_endpoint(1)
        assert response.status_code == 200
```

### Добавление нового теста

Добавьте тестовую функцию в соответствующий класс в файле тестов:

```python
def test_new_scenario(self, api_client, pet_data_generator):
    # Тестовая логика
    pass
```

### Добавление новых тестовых данных

Добавьте данные в соответствующий генератор в `helpers/data_generators.py`:

```python
@classmethod
def generate_special_data(cls):
    return {...}
```

## Статический анализ кода

### Flake8 (стиль кода)

```bash
flake8 helpers tests
```

### MyPy (проверка типов)

```bash
mypy helpers
```

### Pre-commit hooks

Установите pre-commit hooks для автоматической проверки перед коммитом:

```bash
pre-commit install
```

## Изоляция тестов

- Каждый тест использует уникальные ID для создания данных
- Тесты не зависят от порядка выполнения
- Данные автоматически генерируются для каждого теста
- После выполнения тестов данные очищаются (если требуется)

## Известные ограничения

- Тесты используют публичный API Petstore, который может быть временно недоступен
- Некоторые операции могут быть нестабильными из-за природы тестового API
- Данные в публичном API могут изменяться другими пользователями

## Troubleshooting

### Проблема: Тесты падают с ошибкой подключения

**Решение**: Убедитесь, что у вас есть доступ в интернет и API Petstore доступен.

### Проблема: Тесты падают из-за конфликта ID

**Решение**: Это маловероятно, так как используются случайные ID в большом диапазоне. Если проблема повторяется, увеличьте диапазон ID в `PetDataGenerator`.

### Проблема: Импорты не работают

**Решение**: Убедитесь, что вы находитесь в корневой директории проекта и установили все зависимости.

## Поддержка и развитие

Проект разработан с учетом возможности масштабирования до сотен тестов. При добавлении новых тестов следуйте принципам:
- Одна зона ответственности — один файл/класс
- Независимость тестов
- Использование фикстур для переиспользования кода
- Документирование сложных сценариев

## Лицензия

Проект использует открытые библиотеки и предназначен для образовательных целей.

## Контакты

Для вопросов и предложений создайте issue в репозитории проекта.

